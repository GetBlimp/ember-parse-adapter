var ParseConnector=Ember.Mixin.create({applicationId:null,javascriptId:null,restApiId:null,serverUrl:"https://api.parse.com",versionPath:"1",modelPath:"classes",requestHeaders:function(){if(!this.applicationId||!this.restApiId||!this.javascriptId)throw"Hey! You forgot to set your Parse Account info! https://parse.com/apps/";return{"X-Parse-Application-Id":this.applicationId,"X-Parse-REST-API-Key":this.restApiId}},xDomainRequest:function(e,t,r,i,s){var o=new XDomainRequest;"POST"!==e&&(r._method=e,e="POST"),r._ApplicationId=this.applicationId,r._JavaScriptKey=this.javascriptId,r=JSON.stringify(r),o.onload=function(){var e;try{e=JSON.parse(o.responseText)}catch(t){s&&s(o)}e&&i&&i(e,o)},o.onerror=o.ontimeout=function(){s&&s(o)},o.onprogress=function(){},o.open(e,t),o.send(r)},ajax:function(e,t,r){if("undefined"!=typeof XDomainRequest)return this.xDomainRequest(e,t,r.data,r.success,r.error);var i={url:t,context:this,type:e,headers:this.requestHeaders(),success:r.success,error:r.error,contentType:"text/plain"};"GET"!==e&&"DELETE"!==e&&$.extend(i,{data:JSON.stringify(r.data)}),jQuery.ajax(i)},request:function(e,t,r,i,s){"object"===Ember.typeOf(r)&&(s=i,i=r,r=null),"object"!==Ember.typeOf(i)||s||(s=i,i={}),this.ajax(e,this.buildUrl(t,r),{data:i,success:s.success,error:s.error})},batchRequest:function(e,t){var r="%@/%@/batch".fmt(this.serverUrl,this.versionPath);this.ajax("POST",r,{data:e,success:t.success,error:t.error})},buildUrl:function(e,t){var r="%@/%@/%@/%@".fmt(this.serverUrl,this.versionPath,this.modelPath,e);return t&&(r+="/"+t),r}}),ParseJSONSerializer=DS.JSONSerializer.extend({primaryKey:function(){return"objectId"},getTypeName:function(e){if(e.parseType)return e.parseType;var t=(""+e).split(".");return t[t.length-1]},serializeRootObject:function(e,t){var r=this.rootForType(e),i={};return Ember.isArray(t)&&(r=this.pluralize(r)),i[r]=t,i},serializeBatchFor:function(e,t){var r={requests:[]};return this.get("adapter"),t.forEach(function(t){var i={},s=this.getTypeName(t.constructor);i.method=e,i.path="/%@/%@/%@".fmt(this.versionPath,this.modelPath,s),i.body=this.serialize(t,{includeId:!0}),r.requests.push(i)},this),r},addHasMany:function(e,t,r,i){if(i.options.embedded)this._super.apply(this,arguments);else{var s=[];t.get(r).forEach(function(e){var t=e.store.get("adapter");if(!e.get("id"))throw"Can I see your ID please?!?!";s.push({__type:"Pointer",className:t.getTypeName(e.constructor),objectId:e.get("id")})}),e[r]=s}}}),ParseAdapter=DS.Adapter.extend(ParseConnector,{bulkCommit:!0,serializer:ParseJSONSerializer,init:function(){this._super.apply(this,arguments);var e=this.get("serializer");e.versionPath=this.get("versionPath"),e.modelPath=this.get("modelPath")},find:function(e,t,r){var i=this.getTypeName(t);this.request("GET",i,r,{success:function(i){Ember.run(this,function(){this.didFindRecord(e,t,this.makeRootObject(t,i),r)})},error:function(e){Ember.Logger.error("Adapter::find::error",e)}})},findAll:function(e,t){var r=this.getTypeName(t);this.request("GET",r,{success:function(r){Ember.run(this,function(){this.didFindAll(e,t,this.makeRootObject(t,r.results))})},error:function(e){Ember.Logger.error("Adapter::findAll::error",e)}})},findMany:function(e,t,r){var i=this.getTypeName(t);this.request("POST",i,{where:{objectId:{$in:r.join(",")}}},{success:function(r){Ember.run(this,function(){this.didFindMany(e,t,this.makeRootObject(t,r.results))})},error:function(e){Ember.Logger.error("Adapter::findMany::error",e)}})},findQuery:function(e,t,r,i){var s=this.getTypeName(t);this.request("POST",s,{where:r},{success:function(r){Ember.run(this,function(){this.didFindQuery(e,t,this.makeRootObject(t,r.results),i)})},error:function(e){Ember.Logger.error("Adapter::findQuery::error",e)}})},createRecord:function(e,t,r){var i=this.getTypeName(t),s=this.serialize(r,{includeId:!0});this.request("POST",i,s,{success:function(i){Ember.run(this,function(){$.extend(s,i),this.didCreateRecord(e,t,r,this.makeRootObject(t,s))})},error:function(e){Ember.Logger.error("Adapter::createRecord::error",e)}})},createRecords:function(e,t,r){if(this.get("bulkCommit")===!1)return this._super(e,t,r);var i=this.makeBatchFor("POST",r);this.batchRequest(i,{success:function(s){var o=this.extendRecords(s.results,i);Ember.run(this,function(){this.didCreateRecords(e,t,r,this.makeRootObject(t,o))})},error:function(e){Ember.Logger.error("Adapter::createRecords::error",e)}})},updateRecord:function(e,t,r){var i=this.getTypeName(t),s=this.serialize(r,{includeId:!0});this.request("PUT",i,s.objectId,s,{success:function(i){Ember.run(this,function(){$.extend(s,i),this.didUpdateRecord(e,t,r,this.makeRootObject(t,s))})},error:function(e){Ember.Logger.error("Adapter::updateRecord::error",e)}})},updateRecords:function(e,t,r){if(this.get("bulkCommit")===!1)return this._super(e,t,r);var i=this.makeBatchFor("PUT",r);this.batchRequest(i,{success:function(s){var o=this.extendRecords(s.results,i);Ember.run(this,function(){this.didUpdateRecords(e,t,r,this.makeRootObject(t,o))})},error:function(e){Ember.Logger.error("Adapter::updateRecords::error",e)}})},deleteRecord:function(e,t,r){var i=this.getTypeName(t),s=this.serialize(r,{includeId:!0});this.request("DELETE",i,s.objectId,{success:function(){Ember.run(this,function(){this.didDeleteRecord(e,t,r)})},error:function(e){Ember.Logger.error("Adapter::deleteRecord::error",e)}})},deleteRecords:function(e,t,r){if(this.get("bulkCommit")===!1)return this._super(e,t,r);var i=this.makeBatchFor("DELETE",r);this.batchRequest(i,{success:function(){Ember.run(this,function(){this.didDeleteRecords(e,t,r)})},error:function(e){Ember.Logger.error("Adapter::deleteRecords::error",e)}})},batchCommit:function(e){var t=this.makeBatchFor("PUT",e.updated),r=this.makeBatchFor("DELETE",e.deleted),i=this.makeBatchFor("POST",e.created),s={requests:i.requests.concat(t.requests.concat(r.requests))},o=this;this.batchRequest(s,{success:function(){Ember.run(o,function(){o.didSaveRecords(store,type,set)})},error:function(e){Ember.Logger.error("Adapter::batchCommit::error",e)}})},extendRecords:function(e,t){var r=t.requests.map(function(t,r){var i=e[r];return i.success?$.extend(t.body,i.success):t.body});return r},getTypeName:function(e){return this.get("serializer").getTypeName(e)},makeRootObject:function(e,t){return this.get("serializer").serializeRootObject(e,t)},makeBatchFor:function(e,t){return this.get("serializer").serializeBatchFor(e,t)}});ParseAdapter.registerTransform("date",{deserialize:DS.JSONTransforms.date.deserialize,serialize:function(e){return e instanceof Date?e.toISOString():void 0===e?void 0:null}});var ParseMixin=Ember.Mixin.create({createdAt:DS.attr("date"),updatedAt:DS.attr("date")}),ParseModel=DS.Model.extend(ParseMixin);