var ParseConnector=Ember.Mixin.create({applicationId:null,javascriptId:null,restApiId:null,serverUrl:"https://api.parse.com",versionPath:"1",modelPath:"classes",requestHeaders:function(){if(!this.applicationId||!this.restApiId||!this.javascriptId)throw"Hey! You forgot to set your Parse Account info! https://parse.com/apps/";return{"X-Parse-Application-Id":this.applicationId,"X-Parse-REST-API-Key":this.restApiId}},xDomainRequest:function(e,t,r,s,i){var n=new XDomainRequest;"POST"!==e&&(r._method=e,e="POST"),r._ApplicationId=this.applicationId,r._JavaScriptKey=this.javascriptId,r=JSON.stringify(r),n.onload=function(){var e;try{e=JSON.parse(n.responseText)}catch(t){i&&i(n)}e&&s&&s(e,n)},n.onerror=n.ontimeout=function(){i&&i(n)},n.onprogress=function(){},n.open(e,t),n.send(r)},ajax:function(e,t,r){var s=this;return"undefined"!=typeof XDomainRequest?this.xDomainRequest(e,t,r):new Ember.RSVP.Promise(function(i,n){var a={url:t,context:s,type:e,headers:s.requestHeaders(),contentType:"text/plain"};"GET"!==e&&"DELETE"!==e&&$.extend(a,{data:JSON.stringify(r)}),a.success=function(e){Ember.run(null,i,e)},a.error=function(e){e&&(e.then=null),Ember.run(null,n,e)},jQuery.ajax(a)})},request:function(e,t,r,s){var i,n;return"object"===Ember.typeOf(r)||s||(s=r,r=null),r&&r.url?(i=r.url,n=!0):(i=t,n=!1),this.ajax(e,this.buildUrl(i,s,n),{data:r})},batchRequest:function(e){var t="%@/%@/batch".fmt(this.serverUrl,this.versionPath);return this.ajax("POST",t,{data:e})},buildUrl:function(e,t,r,s){var i;return i="DS.ParseUser"===e?"/%@/%@".fmt(this.versionPath,"users"):r?"/%@/%@".fmt(this.versionPath,e):"/%@/%@/%@".fmt(this.versionPath,this.modelPath,e),s||(i=this.serverUrl+i),t&&(i+="/"+t),i}}),ParseJSONSerializer=DS.JSONSerializer.extend({primaryKey:function(){return"objectId"},getTypeName:function(e){if(e===ParseUser||e.superclass===ParseUser)return""+ParseUser;if(e.parseType)return e.parseType;var t=(""+e).split(".");return t[t.length-1]},serializeRootObject:function(e,t){var r=this.rootForType(e),s={};return Ember.isArray(t)&&(r=this.pluralize(r)),s[r]=t,s},serializeBatchFor:function(e,t){var r={requests:[]};return t.forEach(function(t){var s={},i=this.getTypeName(t.constructor),n=t.get("store.adapter");s.method=e,s.path=n.buildUrl(i,t.get("id"),!1,!0),s.body=this.serialize(t,{includeId:!0}),r.requests.push(s)},this),r},addHasMany:function(e,t,r,s){if(s.options.embedded)this._super.apply(this,arguments);else{var i=[];t.get(r).forEach(function(e){var t=e.store.get("adapter");if(!e.get("id"))throw"Can I see your ID please?!?!";i.push({__type:"Pointer",className:t.getTypeName(e.constructor),objectId:e.get("id")})}),e[r]=i}}}),ParseAdapter=DS.Adapter.extend(ParseConnector,{bulkCommit:!0,serializer:ParseJSONSerializer,init:function(){this._super.apply(this,arguments);var e=this.get("serializer");e.versionPath=this.get("versionPath"),e.modelPath=this.get("modelPath")},find:function(e,t,r){var s=this.getTypeName(t),i=this;return this.request("GET",s,r).then(function(s){i.didFindRecord(e,t,i.makeRootObject(t,s),r)},function(e){throw i.didError(e),e}).then(null,DS.rejectionHandler)},findAll:function(e,t){var r=this.getTypeName(t),s=this;return this.request("GET",r).then(function(r){s.didFindAll(e,t,s.makeRootObject(t,r.results))},function(e){throw s.didError(e),e}).then(null,DS.rejectionHandler)},findMany:function(e,t,r){var s=this.getTypeName(t),i=this;return this.request("POST",s,{where:{objectId:{$in:r.join(",")}}}).then(function(r){i.didFindMany(e,t,i.makeRootObject(t,r.results))},function(e){throw i.didError(e),e}).then(null,DS.rejectionHandler)},findQuery:function(e,t,r,s){var i=this.getTypeName(t),n=this;return this.request("POST",i,{where:r}).then(function(r){n.didFindQuery(e,t,n.makeRootObject(t,r.results),s)},function(e){throw n.didError(e),e}).then(null,DS.rejectionHandler)},createRecord:function(e,t,r){var s=this,i=this.getTypeName(t),n=this.serialize(r,{includeId:!0});return this.request("POST",i,n).then(function(i){s.didCreateRecord(e,t,r,i)},function(i){throw s.didError(e,t,r,i),i}).then(null,DS.rejectionHandler)},createRecords:function(e,t,r){if(!this.get("bulkCommit"))return this._super(e,t,r);var s=this.makeBatchFor("POST",r);return this.batchRequest(s).then(function(i){adapter.reconcileBatchResults(e,t,r.toArray(),s.requests,i)},function(s){throw adapter.didError(e,t,r,s),s}).then(null,DS.rejectionHandler)},updateRecord:function(e,t,r){var s=this.getTypeName(t),i=this.serialize(r,{includeId:!0});this.request("PUT",s,i.objectId,i,{success:function(s){Ember.run(this,function(){$.extend(i,s),this.didUpdateRecord(e,t,r,this.makeRootObject(t,i))})},error:function(s){this.didError(e,t,r),Ember.Logger.error("Adapter::updateRecord::error",s)}})},updateRecords:function(e,t,r){if(this.get("bulkCommit")===!1)return this._super(e,t,r);var s=this.makeBatchFor("PUT",r);this.batchRequest(s,{success:function(i){Ember.run(this,function(){this.reconcileBatchResults(e,t,r.toArray(),s.requests,i)})},error:function(e){Ember.Logger.error("Adapter::updateRecords::error",e)}})},deleteRecord:function(e,t,r){var s=this.getTypeName(t),i=this.serialize(r,{includeId:!0});this.request("DELETE",s,i.objectId,{success:function(){Ember.run(this,function(){this.didDeleteRecord(e,t,r)})},error:function(s){this.didError(e,t,r),Ember.Logger.error("Adapter::deleteRecord::error",s)}})},deleteRecords:function(e,t,r){if(this.get("bulkCommit")===!1)return this._super(e,t,r);var s=this.makeBatchFor("DELETE",r);this.batchRequest(s,{success:function(){Ember.run(this,function(){this.didDeleteRecords(e,t,r)})},error:function(e){Ember.Logger.error("Adapter::deleteRecords::error",e)}})},batchCommit:function(e){var t=this.makeBatchFor("PUT",e.updated),r=this.makeBatchFor("DELETE",e.deleted),s=this.makeBatchFor("POST",e.created),i={requests:s.requests.concat(t.requests.concat(r.requests))},n=this;this.batchRequest(i,{success:function(){Ember.run(n,function(){n.didSaveRecords(store,type,set)})},error:function(e){Ember.Logger.error("Adapter::batchCommit::error",e)}})},reconcileBatchResults:function(e,t,r,s,i){s.forEach(function(s,n){var a=i[n],o=r[n];a.success?this.didSaveRecord(e,t,o,this.makeRootObject(t,$.extend(s.body,a.success))):this.didError(e,t,o)},this)},getTypeName:function(e){return this.get("serializer").getTypeName(e)},makeRootObject:function(e,t){return this.get("serializer").serializeRootObject(e,t)},makeBatchFor:function(e,t){return this.get("serializer").serializeBatchFor(e,t)}});ParseAdapter.registerTransform("date",{deserialize:DS.JSONTransforms.date.deserialize,serialize:function(e){return e instanceof Date?e.toISOString():void 0===e?void 0:null}});var PasswordResetState=DS.State.create({isPasswordResetting:!0,requesting:function(e){var t=e.get("record");t.trigger("requestingPasswordReset")},requestSent:function(e){var t=e.get("record");e.transitionTo("loaded.saved"),t.trigger("didRequestPasswordReset")},requestFailed:function(e){var t=e.get("record");t.trigger("resetPasswordFailed")}}),ParseMixin=Ember.Mixin.create({createdAt:DS.attr("date"),updatedAt:DS.attr("date")}),ParseModel=DS.ParseModel=DS.Model.extend(ParseMixin,{isPasswordResetting:Ember.computed(function(e){return get(get(this,"stateManager.currentState"),e)}).property("stateManager.currentState"),init:function(){var e,t=DS.StateManager.create({record:this});t.enableLogging=!0,e=t.get("states.rootState"),e.setupChild(e.get("states"),"passwordReset",PasswordResetState),this.set("stateManager",t),this._setup(),t.goToState("empty")}}),ParseUser=DS.ParseUser=ParseModel.extend({username:DS.attr("string"),email:DS.attr("string"),password:DS.attr("string"),sessionToken:DS.attr("string"),signup:function(e){var t,r=e&&e.username||this.get("username"),s=e&&e.password||this.get("password"),i=this.store,n=this.store.adapter,a=this;if(!r&&!s)throw"Hey - you cannot signup without all this stuff man!";this.set("username",r),this.set("password",s),this.send("willCommit"),t=n.get("serializer").serialize(this),n.request("POST",""+ParseUser,t,{url:"users",success:function(e){Ember.run(n,function(){delete t.password,$.extend(t,e),n.didCreateRecord(i,a.constructor,a,n.makeRootObject(a.constructor,t))})},error:function(){}})},login:function(e){var t,r=e&&e.username||this.get("username"),s=e&&e.password||this.get("password"),i=this.store,n=this.store.adapter,a=this;if(!r&&!s)throw"Hey - you cannot login without all this stuff man!";this.set("username",r),this.set("password",s),this.send("willCommit"),t=n.get("serializer").serialize(this),n.request("GET",""+ParseUser,t,{url:"login",success:function(e){Ember.run(n,function(){delete t.password,$.extend(t,e),n.didCreateRecord(i,a.constructor,a,n.makeRootObject(a.constructor,t))})},error:function(){}})},requestPasswordReset:function(e){var t=e||this.get("email"),r=this.store.adapter,s=this;if(!t)throw"Hey - you need an email to change a password!";this.get("stateManager").goToState("passwordReset"),this.send("requesting"),r.request("POST",""+ParseUser,{email:t},{url:"requestPasswordReset",success:function(){s.send("requestSent")},error:function(){s.send("requestFailed")}})},isCurrent:function(){var e=this.get("sessionToken");return null!==e&&void 0!==e&&""!==e}.property("sessionToken")});